# INTcoin Pool Dashboard - Apache Virtual Host Configuration
#
# Installation:
# 1. Copy this file to /etc/apache2/sites-available/intcoin-pool.conf
# 2. Enable the site: a2ensite intcoin-pool.conf
# 3. Reload Apache: systemctl reload apache2

<VirtualHost *:80>
    ServerName pool.international-coin.org
    ServerAlias www.pool.international-coin.org

    DocumentRoot /var/www/html

    # Redirect HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName pool.international-coin.org
    ServerAlias www.pool.international-coin.org

    DocumentRoot /var/www/html

    # SSL Configuration (Let's Encrypt)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/pool.international-coin.org/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/pool.international-coin.org/privkey.pem

    # Modern SSL settings
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder off

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Enable PHP for webhook
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost"
    </FilesMatch>

    # Directory settings
    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Protect logs directory
    <Directory /var/www/html/logs>
        Require all denied
    </Directory>

    # Cache static assets
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>

    # Don't cache HTML and JSON (for dynamic updates)
    <FilesMatch "\.(html|json)$">
        Header set Cache-Control "no-cache, must-revalidate"
    </FilesMatch>

    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/intcoin-pool-error.log
    CustomLog ${APACHE_LOG_DIR}/intcoin-pool-access.log combined
</VirtualHost>
